{"/Users/createthink/Desktop/git/sharedb-monaco-editor/src/sharedb-monaco-editor.js":{"path":"/Users/createthink/Desktop/git/sharedb-monaco-editor/src/sharedb-monaco-editor.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":7,"column":19},"end":{"line":7,"column":563}},"2":{"start":{"line":7,"column":76},"end":{"line":7,"column":347}},"3":{"start":{"line":7,"column":89},"end":{"line":7,"column":90}},"4":{"start":{"line":7,"column":134},"end":{"line":7,"column":142}},"5":{"start":{"line":7,"column":144},"end":{"line":7,"column":199}},"6":{"start":{"line":7,"column":200},"end":{"line":7,"column":231}},"7":{"start":{"line":7,"column":232},"end":{"line":7,"column":286}},"8":{"start":{"line":7,"column":259},"end":{"line":7,"column":286}},"9":{"start":{"line":7,"column":287},"end":{"line":7,"column":345}},"10":{"start":{"line":7,"column":350},"end":{"line":7,"column":559}},"11":{"start":{"line":7,"column":407},"end":{"line":7,"column":475}},"12":{"start":{"line":7,"column":423},"end":{"line":7,"column":475}},"13":{"start":{"line":7,"column":476},"end":{"line":7,"column":536}},"14":{"start":{"line":7,"column":493},"end":{"line":7,"column":536}},"15":{"start":{"line":7,"column":537},"end":{"line":7,"column":556}},"16":{"start":{"line":9,"column":50},"end":{"line":9,"column":151}},"17":{"start":{"line":9,"column":92},"end":{"line":9,"column":149}},"18":{"start":{"line":11,"column":14},"end":{"line":85,"column":3}},"19":{"start":{"line":13,"column":18},"end":{"line":13,"column":104}},"20":{"start":{"line":15,"column":4},"end":{"line":15,"column":35}},"21":{"start":{"line":17,"column":4},"end":{"line":17,"column":27}},"22":{"start":{"line":18,"column":4},"end":{"line":18,"column":40}},"23":{"start":{"line":19,"column":4},"end":{"line":19,"column":53}},"24":{"start":{"line":20,"column":4},"end":{"line":20,"column":27}},"25":{"start":{"line":22,"column":4},"end":{"line":22,"column":45}},"26":{"start":{"line":23,"column":4},"end":{"line":23,"column":75}},"27":{"start":{"line":47,"column":2},"end":{"line":82,"column":6}},"28":{"start":{"line":50,"column":20},"end":{"line":50,"column":63}},"29":{"start":{"line":51,"column":15},"end":{"line":51,"column":54}},"30":{"start":{"line":52,"column":6},"end":{"line":52,"column":55}},"31":{"start":{"line":53,"column":6},"end":{"line":53,"column":22}},"32":{"start":{"line":58,"column":18},"end":{"line":58,"column":22}},"33":{"start":{"line":60,"column":15},"end":{"line":60,"column":17}},"34":{"start":{"line":61,"column":6},"end":{"line":79,"column":9}},"35":{"start":{"line":62,"column":19},"end":{"line":62,"column":30}},"36":{"start":{"line":63,"column":26},"end":{"line":63,"column":44}},"37":{"start":{"line":64,"column":26},"end":{"line":64,"column":44}},"38":{"start":{"line":66,"column":27},"end":{"line":66,"column":29}},"39":{"start":{"line":67,"column":8},"end":{"line":78,"column":9}},"40":{"start":{"line":69,"column":10},"end":{"line":69,"column":79}},"41":{"start":{"line":70,"column":10},"end":{"line":70,"column":69}},"42":{"start":{"line":71,"column":15},"end":{"line":78,"column":9}},"43":{"start":{"line":73,"column":10},"end":{"line":73,"column":79}},"44":{"start":{"line":74,"column":10},"end":{"line":74,"column":69}},"45":{"start":{"line":75,"column":10},"end":{"line":75,"column":61}},"46":{"start":{"line":77,"column":10},"end":{"line":77,"column":61}},"47":{"start":{"line":80,"column":6},"end":{"line":80,"column":16}},"48":{"start":{"line":84,"column":2},"end":{"line":84,"column":17}},"49":{"start":{"line":87,"column":0},"end":{"line":87,"column":26}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":19},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":31},"end":{"line":7,"column":561}},"line":7},"1":{"name":"defineProperties","decl":{"start":{"line":7,"column":42},"end":{"line":7,"column":58}},"loc":{"start":{"line":7,"column":74},"end":{"line":7,"column":349}},"line":7},"2":{"name":"(anonymous_2)","decl":{"start":{"line":7,"column":357},"end":{"line":7,"column":358}},"loc":{"start":{"line":7,"column":405},"end":{"line":7,"column":558}},"line":7},"3":{"name":"_classCallCheck","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":24}},"loc":{"start":{"line":9,"column":48},"end":{"line":9,"column":153}},"line":9},"4":{"name":"(anonymous_4)","decl":{"start":{"line":11,"column":14},"end":{"line":11,"column":15}},"loc":{"start":{"line":11,"column":26},"end":{"line":85,"column":1}},"line":11},"5":{"name":"Adapter","decl":{"start":{"line":12,"column":11},"end":{"line":12,"column":18}},"loc":{"start":{"line":12,"column":29},"end":{"line":24,"column":3}},"line":12},"6":{"name":"onChange","decl":{"start":{"line":49,"column":20},"end":{"line":49,"column":28}},"loc":{"start":{"line":49,"column":36},"end":{"line":54,"column":5}},"line":49},"7":{"name":"createOpFormChange","decl":{"start":{"line":57,"column":20},"end":{"line":57,"column":38}},"loc":{"start":{"line":57,"column":55},"end":{"line":81,"column":5}},"line":57},"8":{"name":"(anonymous_8)","decl":{"start":{"line":61,"column":28},"end":{"line":61,"column":29}},"loc":{"start":{"line":61,"column":46},"end":{"line":79,"column":7}},"line":61}},"branchMap":{"0":{"loc":{"start":{"line":7,"column":168},"end":{"line":7,"column":198}},"type":"binary-expr","locations":[{"start":{"line":7,"column":168},"end":{"line":7,"column":189}},{"start":{"line":7,"column":193},"end":{"line":7,"column":198}}],"line":7},"1":{"loc":{"start":{"line":7,"column":232},"end":{"line":7,"column":286}},"type":"if","locations":[{"start":{"line":7,"column":232},"end":{"line":7,"column":286}},{"start":{"line":7,"column":232},"end":{"line":7,"column":286}}],"line":7},"2":{"loc":{"start":{"line":7,"column":407},"end":{"line":7,"column":475}},"type":"if","locations":[{"start":{"line":7,"column":407},"end":{"line":7,"column":475}},{"start":{"line":7,"column":407},"end":{"line":7,"column":475}}],"line":7},"3":{"loc":{"start":{"line":7,"column":476},"end":{"line":7,"column":536}},"type":"if","locations":[{"start":{"line":7,"column":476},"end":{"line":7,"column":536}},{"start":{"line":7,"column":476},"end":{"line":7,"column":536}}],"line":7},"4":{"loc":{"start":{"line":9,"column":50},"end":{"line":9,"column":151}},"type":"if","locations":[{"start":{"line":9,"column":50},"end":{"line":9,"column":151}},{"start":{"line":9,"column":50},"end":{"line":9,"column":151}}],"line":9},"5":{"loc":{"start":{"line":13,"column":18},"end":{"line":13,"column":104}},"type":"cond-expr","locations":[{"start":{"line":13,"column":71},"end":{"line":13,"column":83}},{"start":{"line":13,"column":86},"end":{"line":13,"column":104}}],"line":13},"6":{"loc":{"start":{"line":13,"column":18},"end":{"line":13,"column":68}},"type":"binary-expr","locations":[{"start":{"line":13,"column":18},"end":{"line":13,"column":38}},{"start":{"line":13,"column":42},"end":{"line":13,"column":68}}],"line":13},"7":{"loc":{"start":{"line":67,"column":8},"end":{"line":78,"column":9}},"type":"if","locations":[{"start":{"line":67,"column":8},"end":{"line":78,"column":9}},{"start":{"line":67,"column":8},"end":{"line":78,"column":9}}],"line":67},"8":{"loc":{"start":{"line":67,"column":12},"end":{"line":67,"column":48}},"type":"binary-expr","locations":[{"start":{"line":67,"column":12},"end":{"line":67,"column":29}},{"start":{"line":67,"column":33},"end":{"line":67,"column":48}}],"line":67},"9":{"loc":{"start":{"line":71,"column":15},"end":{"line":78,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":15},"end":{"line":78,"column":9}},{"start":{"line":71,"column":15},"end":{"line":78,"column":9}}],"line":71},"10":{"loc":{"start":{"line":71,"column":19},"end":{"line":71,"column":53}},"type":"binary-expr","locations":[{"start":{"line":71,"column":19},"end":{"line":71,"column":34}},{"start":{"line":71,"column":38},"end":{"line":71,"column":53}}],"line":71}},"s":{"0":1,"1":1,"2":1,"3":1,"4":2,"5":2,"6":2,"7":2,"8":2,"9":2,"10":1,"11":1,"12":1,"13":1,"14":0,"15":1,"16":1,"17":0,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":0,"29":0,"30":0,"31":0,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":0,"41":0,"42":1,"43":0,"44":0,"45":0,"46":1,"47":1,"48":1,"49":1},"f":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":1,"8":1},"b":{"0":[2,2],"1":[2,0],"2":[1,0],"3":[0,1],"4":[0,1],"5":[0,1],"6":[1,0],"7":[0,1],"8":[1,0],"9":[0,1],"10":[1,1]},"inputSourceMap":{"version":3,"sources":["sharedb-monaco-editor.js"],"names":["Adapter","instance","options","key","monaco","model","getModel","lastDocLines","getLinesContent","onChange","bind","handleChange","onDidChangeModelContent","event","content","join","getEOL","op","createOpFormChange","console","log","changes","forEach","change","text","rangeLength","rangeOffset","replacedText","length","slice","push","p","sd","si"],"mappings":";;;;;;;;;;IAAMA,O;AACJ,mBAAYC,QAAZ,EAAoD;AAAA,QAA9BC,OAA8B,uEAApB,EAAEC,KAAK,SAAP,EAAoB;;AAAA;;AAClD,SAAKC,MAAL,GAAcH,QAAd;AACA,SAAKI,KAAL,GAAa,KAAKD,MAAL,CAAYE,QAAZ,EAAb;AACA,SAAKC,YAAL,GAAoB,KAAKF,KAAL,CAAWG,eAAX,EAApB;AACA,SAAKL,GAAL,GAAWD,QAAQC,GAAnB;;AAEA,SAAKM,QAAL,GAAgB,KAAKA,QAAL,CAAcC,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKC,YAAL,GAAoB,KAAKP,MAAL,CAAYQ,uBAAZ,CAAoC,KAAKH,QAAzC,CAApB;AACD;;AAED;;;;;;;;;;;;;;;;;;;;;;;6BAmBSI,K,EAAO;AACd,UAAMC,UAAU,KAAKP,YAAL,CAAkBQ,IAAlB,CAAuB,KAAKV,KAAL,CAAWW,MAAX,EAAvB,CAAhB;AACA,UAAMC,KAAK,KAAKC,kBAAL,CAAwBL,KAAxB,EAA+BC,OAA/B,CAAX;AACA,WAAKP,YAAL,GAAoB,KAAKF,KAAL,CAAWG,eAAX,EAApB;AACAW,cAAQC,GAAR,CAAYH,EAAZ;AACD;;;uCAEkBJ,K,EAAOC,O,EAAS;AAAA;;AACjC,UAAMG,KAAK,EAAX;AACAJ,YAAMQ,OAAN,CAAcC,OAAd,CAAsB,UAACC,MAAD,EAAY;AAAA,YACxBC,IADwB,GACWD,MADX,CACxBC,IADwB;AAAA,YAClBC,WADkB,GACWF,MADX,CAClBE,WADkB;AAAA,YACLC,WADK,GACWH,MADX,CACLG,WADK;;AAEhC,YAAIC,eAAe,EAAnB;AACA,YAAIH,KAAKI,MAAL,KAAgB,CAAhB,IAAqBH,cAAc,CAAvC,EAA0C;AACxC;AACAE,yBAAeb,QAAQe,KAAR,CAAcH,WAAd,EAA2BA,cAAcD,WAAzC,CAAf;AACAR,aAAGa,IAAH,CAAQ,EAAEC,GAAG,CAAC,MAAK5B,GAAN,EAAWuB,WAAX,CAAL,EAA8BM,IAAIL,YAAlC,EAAR;AACD,SAJD,MAIO,IAAIH,KAAKI,MAAL,GAAc,CAAd,IAAmBH,cAAc,CAArC,EAAwC;AAC7C;AACAE,yBAAeb,QAAQe,KAAR,CAAcH,WAAd,EAA2BA,cAAcD,WAAzC,CAAf;AACAR,aAAGa,IAAH,CAAQ,EAAEC,GAAG,CAAC,MAAK5B,GAAN,EAAWuB,WAAX,CAAL,EAA8BM,IAAIL,YAAlC,EAAR;AACAV,aAAGa,IAAH,CAAQ,EAAEC,GAAG,CAAC,MAAK5B,GAAN,EAAWuB,WAAX,CAAL,EAA8BO,IAAIT,IAAlC,EAAR;AACD,SALM,MAKA;AACLP,aAAGa,IAAH,CAAQ,EAAEC,GAAG,CAAC,MAAK5B,GAAN,EAAWuB,WAAX,CAAL,EAA8BO,IAAIT,IAAlC,EAAR;AACD;AACF,OAfD;AAgBA,aAAOP,EAAP;AACD;;;;;;kBAGYjB,O","file":"sharedb-monaco-editor.js","sourceRoot":"/Users/createthink/Desktop/git/sharedb-monaco-editor/src","sourcesContent":["class Adapter {\n  constructor(instance, options = { key: 'content' }) {\n    this.monaco = instance;\n    this.model = this.monaco.getModel();\n    this.lastDocLines = this.model.getLinesContent();\n    this.key = options.key;\n\n    this.onChange = this.onChange.bind(this);\n    this.handleChange = this.monaco.onDidChangeModelContent(this.onChange);\n  }\n\n  /**\n   * monaco模型改变时发出的事件 https://microsoft.github.io/monaco-editor/api/interfaces/monaco.editor.istandalonecodeeditor.html#ondidchangemodelcontent\n   * @param {IModelContentChangedEvent} e // https://microsoft.github.io/monaco-editor/api/interfaces/monaco.editor.imodelcontentchangedevent.html\n   * @property {e.changes: IModelContentChange[]}\n   *    range:\n   *      startColumn: 字符开始的列号   同endColumn计算方式\n   *      endColumn: 字符结束的列号   列计算如: abc!  序号从a前面计算为1， 到达插入的！的时候列号为4\n   *      startLineNumber: 字符串开始的行号\n   *      endLineNumber: 字符串结束的行号\n   *    rangeLength: 被*替换*的范围长度，只有删除、选择字符串粘贴、输入字符点击提示自动输入会存在。它表示当前被替换掉字符的长度\n   *    rangeOffset: 被替换范围的偏移量(开始位置)，计算如上面*endColumn*方法一样\n   *    text: 应用到编辑器的新文本，只有插入，粘贴、输入字符串点击提示会存在\n   *\n   * @property {e.isFlush} 编辑器丢失所有decorations，模型被重置为新值\n   * @property {e.isUndoing} 撤销该值为true\n   * @property {e.eol} 行尾字符串\n   * @property {e.isRedoing} 撤销该值为true\n   * @property {e.versionId} 操作版本号递增\n   */\n  onChange(event) {\n    const content = this.lastDocLines.join(this.model.getEOL());\n    const op = this.createOpFormChange(event, content);\n    this.lastDocLines = this.model.getLinesContent();\n    console.log(op);\n  }\n\n  createOpFormChange(event, content) {\n    const op = [];\n    event.changes.forEach((change) => {\n      const { text, rangeLength, rangeOffset } = change;\n      let replacedText = '';\n      if (text.length === 0 && rangeLength > 0) {\n        // 删除\n        replacedText = content.slice(rangeOffset, rangeOffset + rangeLength);\n        op.push({ p: [this.key, rangeOffset], sd: replacedText });\n      } else if (text.length > 0 && rangeLength > 0) {\n        // 粘贴、输入字符点击提示自动输入\n        replacedText = content.slice(rangeOffset, rangeOffset + rangeLength);\n        op.push({ p: [this.key, rangeOffset], sd: replacedText });\n        op.push({ p: [this.key, rangeOffset], si: text });\n      } else {\n        op.push({ p: [this.key, rangeOffset], si: text });\n      }\n    });\n    return op;\n  }\n}\n\nexport default Adapter;\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"dd5a25e17080588a30cfba88b026c58d7efbb26c","contentHash":"39b68d5686d7cb390dfcb90ae7e3264e68241282b0c2edd55685123799acb06b"}}